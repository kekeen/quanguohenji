<%- include('../templates/head') %>
<body>
    <%- include('../templates/nav') %>
    <div class="content">
        <%- include('../templates/study-left-side-list') %>
        <div class="content-right ">
        	<div class="links">
        		<a href="index.html">首页</a> / <a href="###">系统管理</a> / <a href="###" class="at">用户管理</a>
        	</div>
			<div class="console-box whitebox">
				<div class="title-box">
					用户管理
				</div>
				<div class="console-right pull-right">
					<button class="btns" onclick="window.location.href ='系统管理-用户管理-新增用户.html'">
						<span class="tips-num hide">12</span>
						新增用户
					</button>
				</div>
			</div>
			<div class="user-right-cont">
				<div class="unit-box">
					<div class="uni-search">
						<div class="search-box">
							<input type="text" placeholder="请输入单位名称" />
							<a href="javascript:void(0);" class="search-btn">
								<i class="iconfont icon-line-search"></i>
							</a>
						</div>
						<div class="tree-box">
							<div class="allChoose">
								<label><input type="checkbox"/>全选</label>
							</div>
							<!--<div class="ztree" id="tree"></div>-->
							<div>
								<ul id="ztree" class="ztree"></ul>
							</div>
						</div>
					</div>
				</div>
				<div class="right-content-box whitebox user-tableWrap">
					<div class="table-box">
						<div class="console-box-list">
							<%
							var data = [
							{lbs:'警官证号',type:'text',txt:'请输入'},
							{lbs:'姓名',type:'text',txt:'请输入'},
							{lbs:'状态',type:'drop',drop:['禁用','启用']},
							{lbs:'查询',type:'btn'}
							];
							%>
							<%- include('../templates/table_console',{data:data}) %>
						</div>
						<% var thead = ['','警官证号','姓名','单位','角色','状态','操作']; %>
						<table class="tables int-table">
							<thead>
							<tr>
								<% for(var i in thead){
								if(i == 0){ %>
								<th width="50"><%= thead[i] %></th>
								<% }else{ %>
								<th><%= thead[i] %></th>
								<% } %>
								<% } %>
							</tr>
							</thead>
							<tbody>
							<% for(var i=0;i<10;i++){ %>
							<tr>
								<td><input type="checkbox"/></td>
								<td class="title">34568</td>
								<td>陈易信</td>
								<td>单位名称A</td>
								<td>管理员</td>
								<td>
									<div class="f-derail f-derail-s"><span></span><i></i></div>
								</td>
								<td class="operation">
									<a href="#" class="inblock ib-mid txtcol" data-toggle="modal" data-target="#seeDetail">查看</a>
									<a href="系统管理-用户管理-新增用户.html" class="inblock ib-mid txtcol">编辑</a>
									<a href="#" class="inblock ib-mid txtcol" data-toggle="modal" data-target="#remove">删除</a>
								</td>
							</tr>
							<% } %>
							</tbody>
						</table>
						<div class="pag-box">
							<div class="pull-left">
								<input type="checkbox">
								<a class="blueBtn" href="#" data-toggle="modal" data-target="#pl-remove">批量删除</a>
							</div>
							<div class="pagging"></div>
						</div>
					</div>
				</div>
			</div>
        </div>
    </div>
	<%
	var data = [{
		el:'remove',
		title:'删除提示',
		text:'确定删除用户【陈易信】？'
		},{
		el:'pl-remove',
		title:'删除提示',
		text:'确定删除选中的用户？'
	}]
	%>
	<%- include('../templates/modal-delete',{data:data}) %>
	<!--查看-->
	<div class="modal in" id="seeDetail">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header clearfix">
					<span>查看</span>
					<a href="javascript:void(0);" data-dismiss="modal" aria-hidden="true" class="closer"><img src="../images/close.png"></a>
				</div>
				<div class="modal-body">
					<div class="modal-body-cont clearfix">
						<div class="contLeft">
							<div class="img"><img src="../images/hj.png"/></div>
							<p>
								易烊千玺
								<!--男icon-->
								<i class="iconfont iconcom-man"></i>
								<!--女icon-->
								<!--<i class="iconfont iconcom-woman"></i>-->
								<!--无性别icon-->
								<!--<i class="iconfont iconcom-wu"></i>-->
							</p>
							<p class="grayColor">警官证号：345345</p>
							<p class="grayColor">密码：******</p>
						</div>
						<div class="contRight">
							<ul>
								<li><span class="grayColor">单位：</span>湖南省公安厅</li>
								<li><span class="grayColor">职务：</span>处长</li>
								<li><span class="grayColor">职称：</span>教授</li>
								<li><span class="grayColor">角色：</span>地方用户</li>
								<li><span class="grayColor">专业：</span>痕迹检验</li>
								<li><span class="grayColor">状态：</span>启用</li>
								<li><span class="grayColor">联系方式：</span>15034332211</li>
								<li><span class="grayColor">邮箱：</span>duoduo@163.com</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
    <%- include('../templates/foot') %>
</body>
</html>
<script type="text/javascript">
	//$('#seeDetail').modal('show');
    //树组件
    //ztree();
//    function ztree() {
//        $(".result-list").on('click', '.user-del', function() {
//            var that = $(this),
//                target = that.parent(),
//                tree = $("#tree"),
//                txt = that.siblings("span").text(),
//                arr = zTreeObj.getCheckedNodes(),
//                font = $(".result-box .checked-num"),
//                num = parseInt(font.html());
//            for(var i in arr) {
//                if(txt == arr[i].name) {
//                    zTreeObj.checkNode(arr[i], false)
//                    target.remove();
//                    num--;
//                    if(num == 0) {
//                        zTreeObj.checkAllNodes(false);
//                    }
//                    font.html(num);
//                }
//            }
//        });
//        var zTreeObj,
//            folder = "../images/folder.png",
//            folder_open = "../images/folder-open.png",
//            admin = "../images/tree-file.png",
//            setting = {
//                view: {
//                    showTitle: false
//                },
//                check: {
//                    enable: true
//                },
//                callback: {
//                    onCheck: function(e, treeId, treeNode) {
//                        var flag = treeNode.checked,
//                            str = treeNode.name,
//                            target = $(e.currentTarget).parent('.tree-box').siblings('.result-box').find('.result-list'),
//                            lis = target.find('li'),
//                            font = $(".result-box .checked-num"),
//                            arr = zTreeObj.getCheckedNodes(true),
//                            num = 0;
//                        if(flag) {
//                            //选中
//                            if(treeNode.check_Child_State == -1) {
//                                //判断是否选中的是否为子节点
//                                if(lis.text().indexOf(str) == -1) {
//                                    target.append('<li><span>' + str + '</span><a href="javascript:void(0);" class="pull-right user-del"><img src="../images/user_del.png"></a>');
//                                }
//                            } else {
//                                var child_arr = treeNode.children;
//                                for(var i in child_arr) {
//                                    if(lis.text().indexOf(child_arr[i].name) == -1) {
//                                        target.append('<li><span>' + child_arr[i].name + '</span><a href="javascript:void(0);" class="pull-right user-del"><img src="../images/user_del.png"></a>');
//                                    }
//                                }
//                            }
//                        } else {
//                            //取消选中
//                            if(treeNode.check_Child_State == -1) {
//                                //判断是否选中的是否为子节点
//                                lis.each(function() {
//                                    var that = $(this),
//                                        txt = that.find('span').text(),
//                                        index = that.index();
//                                    if(txt == str) {
//                                        lis.eq(index).remove();
//                                    }
//                                })
//                            } else {
//                                lis.remove();
//                            }
//                        }
//                        for(var i in arr) {
//                            if(arr[i].check_Child_State == -1)
//                            //判断是否选中的是否为子节点
//                                num++;
//                        }
//                        font.html(num);
//                    }
//                }
//            },
//            child = [{
//                name: "黄多多",
//                open: true,
//                icon: admin,
//                checked: true
//            }, {
//                name: "陈依依",
//                open: true,
//                icon: admin
//            }, {
//                name: "陈依依1",
//                open: true,
//                icon: admin
//            }, {
//                name: "陈依依2",
//                open: true,
//                icon: admin
//            }]
//        zNodes = [{
//            name: "专家组",
//            open: true,
//            iconClose: folder,
//            iconOpen: folder_open,
//            children: child
//        }];
//        $(document).ready(function() {
//            zTreeObj = $.fn.zTree.init($("#tree"), setting, zNodes);
//        });
//    }
    ztree();
	function ztree() {
        // ztree
        var setting = {
            view: {
                fontCss: getFont,
                addHoverDom: addHoverDom,
                removeHoverDom: removeHoverDom,
                selectedMulti: false
            },
            check: {
                enable: true
            },
            edit: {
                enable: true,
                editNameSelectAll: true,
                showRemoveBtn: showRemoveBtn,
                showRenameBtn: showRenameBtn
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                beforeDrag: beforeDrag,
                // beforeEditName: beforeEditName,
                beforeRemove: beforeRemove,
                beforeRename: beforeRename,
                onRemove: onRemove,
                onRename: onRename
            }
        };

        var zNodes = [
            { id: 1, pId: 0, name: "父节点 1", iconSkin: 'pIcon01' },
            { id: 11, pId: 1, name: "叶子节点 1-1", iconSkin: 'icon01' },
            { id: 12, pId: 1, name: "叶子节点 1-2", iconSkin: 'icon01' },
            { id: 13, pId: 1, name: "叶子节点 1-3", iconSkin: 'icon01' },
            { id: 2, pId: 0, name: "父节点 2", iconSkin: 'pIcon01' },
            { id: 21, pId: 2, name: "叶子节点 2-1", iconSkin: 'icon01' },
            { id: 22, pId: 2, name: "叶子节点 2-2", iconSkin: 'icon01' },
            { id: 23, pId: 2, name: "叶子节点 2-3", iconSkin: 'icon01' },
            { id: 3, pId: 0, name: "父节点 3", iconSkin: 'pIcon01' },
            { id: 31, pId: 3, name: "叶子节点 3-1", iconSkin: 'icon01' },
            { id: 32, pId: 3, name: "叶子节点 3-2", iconSkin: 'icon01' },
            { id: 33, pId: 3, name: "叶子节点 3-3", iconSkin: 'icon01' }
        ];

        var log, className = "dark";
        function beforeDrag(treeId, treeNodes) {
            return false;
        }
        // 控制字体样式
        function getFont(treeId, node) {
            if (node.pId) {
                node.font = { 'font-size': '12px' };
            }
            return node.font ? node.font : {};
        }
        // 编辑确认
        function beforeEditName(treeId, treeNode) {
            className = (className === "dark" ? "" : "dark");
            showLog("[ " + getTime() + " beforeEditName ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
            var zTree = $.fn.zTree.getZTreeObj("ztree");
            zTree.selectNode(treeNode);
            setTimeout(function () {
                if (confirm("进入节点 -- " + treeNode.name + " 的编辑状态吗？")) {
                    setTimeout(function () {
                        zTree.editName(treeNode);
                    }, 0);
                }
            }, 0);
            return false;
        }
        // 删除确认
        function beforeRemove(treeId, treeNode) {
            className = (className === "dark" ? "" : "dark");
            showLog("[ " + getTime() + " beforeRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
            var zTree = $.fn.zTree.getZTreeObj("ztree");
            zTree.selectNode(treeNode);
            return confirm("确认删除 节点 -- " + treeNode.name + " 吗？");
        }
        // 删除
        function onRemove(e, treeId, treeNode) {
            showLog("[ " + getTime() + " onRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
        }
        // 内容判断
        function beforeRename(treeId, treeNode, newName, isCancel) {
            className = (className === "dark" ? "" : "dark");
            showLog((isCancel ? "<span style='color:red'>" : "") + "[ " + getTime() + " beforeRename ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name + (isCancel ? "</span>" : ""));
            if (newName.length == 0) {
                setTimeout(function () {
                    var zTree = $.fn.zTree.getZTreeObj("ztree");
                    zTree.cancelEditName();
                    alert("节点名称不能为空.");
                }, 0);
                return false;
            }
            return true;
        }
        // 重命名
        function onRename(e, treeId, treeNode, isCancel) {
            showLog((isCancel ? "<span style='color:red'>" : "") + "[ " + getTime() + " onRename ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name + (isCancel ? "</span>" : ""));
        }
        // 删除按钮
        function showRemoveBtn(treeId, treeNode) {
            return !treeNode.isFirstNode;
        }
        // 编辑按钮
        function showRenameBtn(treeId, treeNode) {
            return !treeNode.isLastNode;
        }
        function showLog(str) {
            if (!log) log = $("#log");
            log.append("<li class='" + className + "'>" + str + "</li>");
            if (log.children("li").length > 8) {
                log.get(0).removeChild(log.children("li")[0]);
            }
        }
        // 获取时间
        function getTime() {
            var now = new Date(),
                h = now.getHours(),
                m = now.getMinutes(),
                s = now.getSeconds(),
                ms = now.getMilliseconds();
            return (h + ":" + m + ":" + s + " " + ms);
        }
        // 添加移入状态
        var newCount = 1;
        function addHoverDom(treeId, treeNode) {
            var sObj = $("#" + treeNode.tId + "_span");
            if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return;
            var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
                + "' title='add node' onfocus='this.blur();'></span>";
            sObj.after(addStr);
            var btn = $("#addBtn_" + treeNode.tId);
            if (btn) btn.bind("click", function () {
                var zTree = $.fn.zTree.getZTreeObj("ztree");
                zTree.addNodes(treeNode, { id: (100 + newCount), pId: treeNode.id, name: "new node" + (newCount++) });
                return false;
            });
        };
        // 移除移入状态
        function removeHoverDom(treeId, treeNode) {
            $("#addBtn_" + treeNode.tId).unbind().remove();
        };
        // 全选
        function selectAll() {
            var zTree = $.fn.zTree.getZTreeObj("ztree");
            zTree.setting.edit.editNameSelectAll = $("#selectAll").attr("checked");
        }

        $(document).ready(function () {
            $.fn.zTree.init($("#ztree"), setting, zNodes);
            $("#selectAll").bind("click", selectAll);
        });
    }
    // 开关按钮
    derail();
    function derail() {
        $('.f-derail').on('click', function () {
            if ($(this).hasClass('on')) {
                $(this).removeClass('on');
            }
            else {
                $(this).addClass('on');
            }
        })
    }
</script>